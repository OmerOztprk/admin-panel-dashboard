<div class="page-wrap">
  <h1 class="page-title gradient-text">Edit Profile</h1>

  <div class="app-card profile-update-card with-accent">
    <section class="profile-update__header">
      <button class="back-btn" type="button" (click)="goBack()" aria-label="Back to profile">
        <svg class="icon-left" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M15 18l-6-6 6-6" />
        </svg>
        <span>Back</span>
      </button>
    </section>

    <section class="profile-section profile-section--top" *ngIf="auth.currentUserSig() as u">
      <div class="app-avatar" aria-label="Avatar">{{ u.avatar }}</div>
      <div class="identity">
        <div class="fullname">{{ u.firstName }} {{ u.lastName }}</div>
        <div class="email">{{ u.email }}</div>
      </div>
    </section>

    <section class="profile-section profile-section--form">
      <form [formGroup]="form" (ngSubmit)="submit()">
        <div class="form-row">
          <div class="input-group">
            <label for="firstName">First Name</label>
            <div class="input-wrapper" [class.error]="form.get('firstName')?.touched && form.get('firstName')?.invalid">
              <span class="icon" aria-hidden="true">
                <svg viewBox="0 0 24 24">
                  <circle cx="12" cy="8" r="4" />
                  <path d="M4 20c1.5-4 14.5-4 16 0" />
                </svg>
              </span>
              <input id="firstName" type="text" formControlName="firstName">
            </div>
            <div class="field-error" *ngIf="form.get('firstName')?.touched && form.get('firstName')?.invalid">
              <div *ngIf="form.get('firstName')?.errors?.['required']">First name is required</div>
              <div *ngIf="form.get('firstName')?.errors?.['minlength']">First name must be at least 2 characters</div>
              <div *ngIf="form.get('firstName')?.errors?.['maxlength']">First name must be between 2 and 25 characters
              </div>
            </div>
          </div>

          <div class="input-group">
            <label for="lastName">Last Name</label>
            <div class="input-wrapper" [class.error]="form.get('lastName')?.touched && form.get('lastName')?.invalid">
              <span class="icon" aria-hidden="true">
                <svg viewBox="0 0 24 24">
                  <circle cx="12" cy="8" r="4" />
                  <path d="M4 20c1.5-4 14.5-4 16 0" />
                </svg>
              </span>
              <input id="lastName" type="text" formControlName="lastName">
            </div>
            <div class="field-error" *ngIf="form.get('lastName')?.touched && form.get('lastName')?.invalid">
              <div *ngIf="form.get('lastName')?.errors?.['required']">Last name is required</div>
              <div *ngIf="form.get('lastName')?.errors?.['minlength']">Last name must be at least 2 characters</div>
              <div *ngIf="form.get('lastName')?.errors?.['maxlength']">Last name must be between 2 and 25 characters
              </div>
            </div>
          </div>
        </div>

        <div class="input-group">
          <label for="email">Email</label>
          <div class="input-wrapper">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <rect x="2" y="4" width="20" height="16" rx="2" />
                <polyline points="2,6 12,13 22,6" />
              </svg>
            </span>
            <input id="email" type="email" formControlName="email" [disabled]="true">
          </div>
        </div>

        <div class="input-group">
          <label for="currentPassword">Current Password</label>
          <div class="input-wrapper"
            [class.error]="(form.get('currentPassword')?.touched || form.get('newPassword')?.touched) && passwordFormError('passwordPair')">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <rect x="3" y="11" width="18" height="10" rx="2" />
                <path d="M7 11V7a5 5 0 0 1 10 0v4" />
              </svg>
            </span>
            <input id="currentPassword" [type]="showCurrent() ? 'text':'password'" formControlName="currentPassword">
            <button type="button" class="password-toggle" (click)="toggleCurrent()"
              [attr.aria-label]="showCurrent() ? 'Hide current password' : 'Show current password'">
              <svg *ngIf="!showCurrent()" viewBox="0 0 24 24">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8Z" />
                <circle cx="12" cy="12" r="3" />
              </svg>
              <svg *ngIf="showCurrent()" viewBox="0 0 24 24">
                <path
                  d="M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8a21.83 21.83 0 0 1 3.06-4.58M9.9 4.24A10.94 10.94 0 0 1 12 4c7 0 11 8 11 8a21.83 21.83 0 0 1-4.06 5.06M14.12 14.12a3 3 0 0 1-4.24-4.24M1 1l22 22" />
              </svg>
            </button>
          </div>
        </div>

        <div class="input-group">
          <label for="newPassword">New Password</label>
          <div class="input-wrapper"
            [class.error]="(form.get('newPassword')?.touched || form.get('currentPassword')?.touched) && (passwordFormError('passwordPair') || form.get('newPassword')?.errors)">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <path d="M12 17v.01" />
                <rect x="3" y="11" width="18" height="10" rx="2" />
                <path d="M7 11V7a5 5 0 0 1 10 0v4" />
              </svg>
            </span>
            <input id="newPassword" [type]="showNew() ? 'text':'password'" formControlName="newPassword">
            <button type="button" class="password-toggle" (click)="toggleNew()"
              [attr.aria-label]="showNew() ? 'Hide new password' : 'Show new password'">
              <svg *ngIf="!showNew()" viewBox="0 0 24 24">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8Z" />
                <circle cx="12" cy="12" r="3" />
              </svg>
              <svg *ngIf="showNew()" viewBox="0 0 24 24">
                <path
                  d="M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8a21.83 21.83 0 0 1 3.06-4.58M9.9 4.24A10.94 10.94 0 0 1 12 4c7 0 11 8 11 8a21.83 21.83 0 0 1-4.06 5.06M14.12 14.12a3 3 0 0 1-4.24-4.24M1 1l22 22" />
              </svg>
            </button>
          </div>

          <div class="field-error" *ngIf="(form.get('currentPassword')?.touched || form.get('newPassword')?.touched) && (
            passwordFormError('passwordPair') ||
            form.get('newPassword')?.errors
          )">
            <div *ngIf="passwordFormError('passwordPair')">Both current and new passwords are required together</div>
            <div *ngIf="form.get('newPassword')?.errors?.['minlength']">New password must be at least 8 characters long
            </div>
            <div *ngIf="form.get('newPassword')?.errors?.['pattern']">
              New password must contain at least one lowercase letter, one uppercase letter, one number and one special
              character
            </div>
          </div>
        </div>

        <div class="alert alert-error" *ngIf="error()">{{ error() }}</div>

        <button class="btn" type="submit" [disabled]="form.invalid || saving()">
          {{ saving() ? 'Saving...' : 'Save Changes' }}
        </button>
      </form>
    </section>
  </div>
</div>