<div class="page-wrap">
  <h1 class="page-title gradient-text">{{ title() }}</h1>

  <div class="app-card with-accent">
    <div class="card-header">
      <button class="back-btn" type="button" (click)="goBack()" aria-label="Back">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <path d="M15 18l-6-6 6-6" />
        </svg>
        <span>Back</span>
      </button>
    </div>

    <form [formGroup]="form" (ngSubmit)="submit()">
      <div class="form-row">
        <div class="input-group">
          <label for="name">Name</label>
          <div class="input-wrapper" [class.error]="form.get('name')?.touched && form.get('name')?.invalid">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <circle cx="12" cy="8" r="4" />
                <path d="M4 20c1.5-4 14.5-4 16 0" />
              </svg>
            </span>
            <input id="name" type="text" formControlName="name" placeholder="admin">
          </div>
          <div class="field-error" *ngIf="form.get('name')?.touched && form.get('name')?.invalid">
            <div *ngIf="form.get('name')?.errors?.['required']">Role name is required</div>
            <div *ngIf="form.get('name')?.errors?.['minlength']">Role name must be at least 2 characters</div>
            <div *ngIf="form.get('name')?.errors?.['maxlength']">Role name must be between 2 and 50 characters</div>
            <div *ngIf="form.get('name')?.errors?.['pattern']">Role name can only contain letters, numbers, spaces,
              hyphens and underscores</div>
          </div>
        </div>

        <div class="input-group">
          <label for="displayName">Display Name</label>
          <div class="input-wrapper">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <rect x="3" y="6" width="18" height="12" rx="2" />
                <path d="M7 10h10M7 14h7" />
              </svg>
            </span>
            <input id="displayName" type="text" formControlName="displayName" placeholder="Administrator">
          </div>
          <div class="field-error" *ngIf="form.get('displayName')?.touched && form.get('displayName')?.invalid">
            <div *ngIf="form.get('displayName')?.errors?.['maxlength']">Display name must be at most 100 characters
            </div>
          </div>
        </div>
      </div>

      <div class="input-group">
        <label for="permissions">Permissions</label>
        <div id="permissions">
          <ng-container *ngIf="permissions()?.length; else emptyPerms">
            <div class="permissions-group" *ngFor="let key of resourceOrder">
              <ng-container *ngIf="groupedPermissions()[key]?.length">
                <div class="group-title">{{ resourceLabels[key] }}</div>
                <div class="checklist">
                  <div class="form-check" *ngFor="let p of groupedPermissions()[key]; trackBy: trackByPermissionId">
                    <input type="checkbox" [id]="'perm-' + p._id" [checked]="isPermSelected(p._id)"
                      (change)="togglePerm(p._id, $event.target.checked)">
                    <label [for]="'perm-' + p._id">{{ p.name }}</label>
                  </div>
                </div>
              </ng-container>
            </div>
          </ng-container>

          <ng-template #emptyPerms>
            <span class="chip chip--muted">No permissions available</span>
          </ng-template>
        </div>
      </div>

      <div class="alert alert-error" *ngIf="error()" aria-live="assertive">
        <span class="alert__icon" aria-hidden="true">
          <svg viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10"/>
            <line x1="15" y1="9" x2="9" y2="15"/>
            <line x1="9" y1="9" x2="15" y2="15"/>
          </svg>
        </span>
        {{ error() }}
      </div>

      <button class="btn" type="submit" [disabled]="form.invalid || saving()" [class.loading]="saving()">
        <span *ngIf="!saving()">{{ submitLabel() }}</span>
      </button>
    </form>
  </div>
</div>