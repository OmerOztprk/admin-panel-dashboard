<div class="page-wrap">
  <h1 class="page-title gradient-text">Active Sessions</h1>

  <div *ngIf="!loading(); else loadingTpl" class="app-card sessions-card with-accent">
    <section class="sessions-header">
      <button class="back-btn" (click)="back()" aria-label="Back to dashboard">
        <svg viewBox="0 0 24 24" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <path d="M15 18l-6-6 6-6" />
        </svg>
        <span>Back</span>
      </button>

      <div class="header-actions" *ngIf="sessions().length">
        <button class="btn--ghost btn--danger" type="button" (click)="revokeAll()" [disabled]="actionLoading()">
          {{ actionLoading() ? 'Processingâ€¦' : 'Revoke All' }}
        </button>
      </div>
    </section>

    <div class="alert alert-success" *ngIf="success()">{{ success() }}</div>
    <div class="alert alert-error" *ngIf="error()">{{ error() }}</div>

    <section *ngIf="sessions().length;" class="sessions-list">
      <div class="session-item" *ngFor="let s of sortedSessions(); trackBy: trackById"
        [class.is-current]="isCurrent(s)">
        <div class="session-body">
          <div class="row-1">
            <span class="ip" title="Client IP">{{ s.ip || 'Unknown IP' }}</span>
            <span class="ua" *ngIf="s.userAgent" title="User Agent">{{ s.userAgent }}</span>
          </div>
          <div class="row-2">
            <div class="kv">
              <span class="k">Created</span>
              <span class="v">{{ s.createdAt | date:'short' }}</span>
            </div>
            <div class="kv">
              <span class="k">Expires</span>
              <span class="v">{{ s.expiresAt | date:'short' }}</span>
            </div>
          </div>
        </div>
        <div class="session-actions">
          <button class="btn--ghost btn--danger btn--sm" (click)="revokeOne(s._id)" [disabled]="actionLoading()"
            type="button">Revoke</button>
        </div>
      </div>
    </section>

    <nav class="pagination" *ngIf="meta()" aria-label="Pagination">
      <div class="pagination-controls" *ngIf="meta()!.totalPages > 1">
        <button class="btn--ghost btn--sm" [disabled]="!hasPrev()" (click)="changePage(meta()!.page - 1)"
          type="button">Previous</button>
        <span class="page-info">Page {{ meta()!.page }} of {{ meta()!.totalPages }}</span>
        <button class="btn--ghost btn--sm" [disabled]="!hasNext()" (click)="changePage(meta()!.page + 1)"
          type="button">Next</button>
      </div>

      <div class="pagination-meta">
        <div class="meta-chip">
          Total: <strong>{{ meta()!.total }}</strong>
        </div>
        <div class="meta-chip" *ngIf="meta()!.totalPages > 1">
          Page <strong>{{ meta()!.page }}</strong> / {{ meta()!.totalPages }}
        </div>
      </div>
    </nav>
  </div>
</div>

<ng-template #loadingTpl>
  <div class="app-card sessions-card skeleton with-accent">
    <div class="skeleton-line wide"></div>
    <div class="skeleton-line"></div>
    <div class="skeleton-line"></div>
    <div class="skeleton-line half"></div>
  </div>
</ng-template>